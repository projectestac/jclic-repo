<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="jclic-player-js">
  <template>
    <style>
      :host {
        @apply(--paper-dialog);
        @apply(--jclic-player-js);
        margin: 0 !important;
        padding: 0;
      }
    </style>
    <div id="playerDiv"></div>
  </template>
</dom-module>

<script>
  /* global $ */
  Polymer({
    is: 'jclic-player-js',
    properties: {
      options: {
        type: Object,
        value: {}
      },
      project: {
        type: String,
        observer: '_setProject'
      },
      fullscreen: {
        type: Boolean,
        value: false
      },
      _player: {
        type: Object,
        value: null,
        reflectToAttribute: false,
        notify: false
      }
    },
    _setProject: function (project) {
      var $div = this.$fitPlayer();
      if (!this._player) {
        this._player = new window.JClicObject.JClicPlayer($div, this.options);
        var thisElement = this;
        $(window).resize(function () {
          thisElement.$fitPlayer();
        });
      }

      var thisPlayer = this._player;
      thisPlayer.initReporter().then(function(){
          thisPlayer.load(project);
      });

      if (this.fullscreen) {
        this._player.skin.setScreenFull(true);
      }
    },
    $fitPlayer: function () {
      var $playerDiv = $(this.$.playerDiv);
      var $rootParent = $playerDiv.parent().parent().parent();
      $playerDiv.css({
        width: $rootParent.width(),
        height: $rootParent.height()
      });
      if (this._player && this._player.skin) {
        this._player.skin.fit();
      }
      return $playerDiv;
    }
  });
</script>
