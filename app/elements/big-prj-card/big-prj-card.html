
<link rel="import" href="../../bower_components/polymer/polymer.html">
<!-- build:js ../../bower_components/clipboard.js/clipboard.js -->
<script src="../../bower_components/clipboard.js/clipboard.js"></script>
<!-- endbuild -->

<dom-module id="big-prj-card">
  <template>
    <style>
      :host {
        @apply(--paper-dialog);
        @apply(--big-prj-card);
      }

      td {
        padding: 0;
      }

      .label {
        font-weight: bold;
        color: var(--secondary-text-color, --primary-text-color);
        padding-right: 5px;
      }

      .school {
        font-style: italic;
      }

      .cover {
        float: right;
        margin: 5px 0px 5px 5px;
        max-width: 50%;
      }

      .author{
        margin-bottom: 0;
      }

      .school{
        margin-top: 0;
      }

      #dialog {
        max-width: 700px;
      }

      #shareDlg {        
        max-width: 700px;
      }

      paper-dialog h2 {
        white-space: normal;
      }

      .dades {
        min-width: 80%;
      }

      paper-fab {
        margin-right: 10px;
      }

      .horizontal-section-container {
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);
        @apply(--layout-wrap);
      }

      .vertical-section-container {
        @apply(--layout-vertical);
        @apply(--center-justified);
      }

      .horizontal-section {
        background-color: white;
        padding: 12px;
        margin-right: 12px;
        min-width: 200px;

        @apply(--shadow-elevation-2dp);
      }

      .vertical-section {
        background-color: white;
        padding: 12px;
        margin: 0 12px 12px 12px;        

        @apply(--shadow-elevation-2dp);
      }
      
      .social {
        height: 28px;
        width: 28px;
        padding: 0;
        margin: 0;
        color: var(--secondary-text-color, --primary-text-color);
      }
      
      a {
        color: inherit;
      }

    </style>
    <paper-dialog id="dialog" modal entry-animation="scale-up-animation" exit-animation="fade-out-animation">
      <h2>[[prj.title]]</h2>      
      <paper-dialog-scrollable>
        <img class="cover" src="[[imgSrc]]"/>
        <p class="author">[[prj.author]]</p>    
        <p class="school">[[prj.school]]</p>    
        <p class="description" id="description"></p>
        <table class="dades">
          <tr><td class="label"><span>[[labels.languages]]</span>:</td><td>[[fields.languages]]</td></tr>
          <tr><td class="label"><span>[[labels.subjects]]</span>:</td><td>[[fields.areas]]</td></tr>
          <tr><td class="label"><span>[[labels.levels]]</span>:</td><td>[[fields.levels]]</td></tr>
          <tr><td class="label"><span>[[labels.date]]</span>:</td><td>[[prj.date]]</td></tr>
          <tr><td class="label"><span>[[labels.license]]</span>:</td><td id="license"></td></tr>
        </table>
      </paper-dialog-scrollable>      
      <div class="buttons">
        <paper-icon-button mini icon="av:play-circle-filled" title="[[labels.playText]]" id="play" on-tap="_tapPlay"></paper-icon-button>
        <!-- paper-button id="play" icon="av:play-arrow" title="[[labels.playText]]" on-tap="_tapPlay">[[labels.play]]</paper-button -->
        <paper-icon-button disabled="[[appletDisabled]]" mini icon="maps:local-cafe" id="playApplet" title="[[labels.playAppletText]]" on-tap="_tapPlayApplet"></paper-icon-button>
        <!-- paper-button id="playApplet" title="[[labels.playAppletText]]" on-tap="_tapPlayApplet">[[labels.playApplet]]</paper-button -->
        <paper-icon-button disabled="[[instalDisabled]]" mini icon="file-download" id="install" title="[[labels.installText]]" on-tap="_tapInstall"></paper-icon-button>
        <paper-icon-button disabled="[[linkDisabled]]" mini icon="av:video-library" id="clicZone" title="[[labels.linkClicZoneText]]" on-tap="_tapLinkClicZone"></paper-icon-button>
        <paper-icon-button mini icon="social:share" id="share" title="[[labels.shareText]]" on-tap="_tapShare"></paper-icon-button>
        <span class="flex"></span>
        <paper-icon-button dialog-dismiss icon="close" title="[[labels.close]]"></paper-icon-button>
        <!-- paper-button dialog-dismiss>[[labels.close]]</paper-button -->
      </div>
      <content></content>
    </paper-dialog>

    <paper-dialog id="shareDlg" modal entry-animation="scale-up-animation" exit-animation="fade-out-animation">
      <h2><span>[[labels.share]]</span> "<span>[[prj.title]]</span>"</h2>
      <paper-dialog-scrollable>
        <div class="vertical-section-container">
          <div class ="vertical-section">
            <paper-input label="[[labels.linkToProject]]" readonly="true" value="[[linkToPage]]">
              <paper-icon-button suffix icon="content-copy" title="[[labels.copy]]" on-tap="_copyPageLink"></paper-icon-button>
            </paper-input>
            <social-buttons url="[[linkToPage]]" imgurl="[[imgSrc]]" text="[[prj.title]]" labels="[[labels]]" lang="[[lang]]"></social-buttons>
          </div>
          <div class ="vertical-section">
            <paper-input label="[[labels.linkToActivities]]" readonly="true" value="[[linkToActivities]]">
              <paper-icon-button suffix icon="content-copy" title="[[labels.copy]]" on-tap="_copyActLink"></paper-icon-button>
            </paper-input>
            <social-buttons url="[[linkToActivities]]" imgurl="[[imgSrc]]" text="[[prj.title]]" labels="[[labels]]" lang="[[lang]]"></social-buttons>
          </div>
          <div class ="vertical-section">
            <paper-input label="[[labels.embedCode]]" readonly="true" value="[[embedCode]]">
              <paper-icon-button suffix icon="content-copy" title="[[labels.copy]]" on-tap="_copyEmbedCode"></paper-icon-button>
            </paper-input>
            <div class = "horizontal-section-container">
              <paper-radio-group selected="{{embedSize}}">
                <paper-radio-button name="small">640x390</paper-radio-button>
                <paper-radio-button name="medium">800x600</paper-radio-button>
                <paper-radio-button name="full">100%</paper-radio-button>
                <span class="flex"></span>
              </paper-radio-group>
            </div>        
          </div>
        </div>
      </paper-dialog-scrollable>
      <div class="buttons">
        <span class="flex"></span>        
        <paper-icon-button dialog-dismiss icon="close" title="[[labels.close]]"></paper-icon-button>
      </div>      
    </paper-dialog>

  </template>
</dom-module>

<script>
/* global clipboard */

Polymer({
  is: 'big-prj-card',
  properties: {
    baseUrl: {
      type: String
    },
    projectsPath: {
      type: String
    },
    /**
     * The project data.
     */
    prj: {
      type: Object,
      observer: '_prjChanged'
    },
    path: {
      type: String,
      value: ''
    },
    labels: {
      type: Object,
      value: {}
    },
    lang: {
      type: String
    },
    imgSrc: {
      type: String,
      computed: 'computeImgSrc(path, prj)'
    },
    fields: {
      type: Object,
      computed: 'computeFields(prj, lang)',
      observer: '_fieldsChanged'
    },
    appletDisabled: {
      type: String,
      computed: 'computeAppletDisabled(prj)'
    },
    instalDisabled: {
      type: String,
      computed: 'computeInstalDisabled(prj)'
    },
    linkDisabled: {
      type: String,
      computed: 'computeLinkDisabled(prj)'
    },
    linkToPage: {
      type: String,
      computed: 'computeLinkToPage(prj)'
    },
    linkToActivities: {
      type: String,
      computed: 'computeLinkToActivities(prj)'
    },
    embedSize: {
      type: String,
      value: 'medium'
    },
    embedCode: {
      type: String,
      computed: 'computeEmbedCode(linkToActivities,embedSize)'
    }
  },
  computeImgSrc: function (path, prj) {
    return path + '/' + prj.cover;
  },
  computeFields: function (prj, lang) {
    return {
      description: prj.description[lang],
      languages: prj.languages[lang],
      areas: prj.areas[lang],
      levels: prj.levels[lang],
      license: prj.license[lang]
    };
  },
  computeAppletDisabled: function () {
    return !this.prj.zipFile || this.prj.app.javaDisabled;
  },
  computeInstalDisabled: function () {
    return !this.prj.instFile || this.prj.app.javaDisabled;
  },
  computeLinkDisabled: function () {
    return !this.prj.clicZoneURL;
  },
  computeLinkToPage: function () {
    return this.baseUrl + 'index.html?prj=' + this.prj.path;
  },
  computeLinkToActivities: function () {
    return this.baseUrl + 'player.html?' + this.projectsPath + '/' + this.prj.path + '/' + this.prj.mainFile;
  },
  computeEmbedCode: function () {
    var w, h;
    switch (this.embedSize) {
      case 'small':
        w='640';
        h='390';
        break;
      case 'medium':
        w='800';
        h='600';
        break;
      default:
        w='100%';
        h='100%';
        break;
    }
    return '<iframe width="' + w + '" height="' + h +
            '" frameborder="0" allowFullScreen="true" src="' + this.linkToActivities + '"></iframe>';
  },
  _prjChanged: function (prj) {
    this.setAttribute('aria-label', prj.title);
  },
  _fieldsChanged: function (fields) {
    this.$.description.innerHTML = fields.description;
    this.$.license.innerHTML = fields.license;
  },
  getPaperDialog: function () {
    return this.$.dialog;
  },
  _tapPlay: function () {
    this.prj.app.playActivities(this.prj);
  },
  _tapPlayApplet: function () {
    this.prj.app.openApplet(this.prj);
  },
  _tapInstall: function () {
    this.prj.app.openInstall(this.prj);
  },
  _tapLinkClicZone: function () {
    this.prj.app.goToClicZone(this.prj);
  },
  _tapShare: function () {
    this.$.dialog.close();
    this.$.shareDlg.open();
  },
  _copyPageLink: function () {
    clipboard.copy(this.linkToPage);
  },
  _copyActLink: function () {
    clipboard.copy(this.linkToActivities);
  },
  _copyEmbedCode: function () {
    clipboard.copy(this.embedCode);
  }
});
</script>