
<link rel="import" href="../../bower_components/polymer/polymer.html">
<!-- build:js ../../bower_components/clipboard.js/clipboard.js -->
<script src="../../bower_components/clipboard.js/clipboard.js"></script>
<!-- endbuild -->

<dom-module id="big-prj-card">
  <template>
    <style>
      :host {
        @apply(--paper-dialog);
        @apply(--big-prj-card);
      }

      td {
        padding: 0;
      }

      .label {
        font-weight: bold;
        color: var(--secondary-text-color, --primary-text-color);
        padding-right: 5px;
      }

      .school {
        font-style: italic;
      }

      .cover {
        float: right;
        margin: 5px 0px 5px 5px;
        max-width: 50%;
      }

      .author{
        margin-bottom: 0;
      }

      .school{
        margin-top: 0;
      }

      paper-dialog {
        max-width: 700px;
      }

      paper-dialog h2 {
        white-space: normal;
      }

      .dades {
        min-width: 80%;
      }

      paper-fab {
        margin-right: 10px;
      }

    </style>
    <paper-dialog id="dialog" modal entry-animation="scale-up-animation" exit-animation="fade-out-animation">
      <h2>[[prj.title]]</h2>      
      <paper-dialog-scrollable>
        <img class="cover" src="[[imgSrc]]"/>
        <p class="author">[[prj.author]]</p>    
        <p class="school">[[prj.school]]</p>    
        <p class="description" id="description"></p>
        <table class="dades">
          <tr><td class="label"><span>[[labels.languages]]</span>:</td><td>[[fields.languages]]</td></tr>
          <tr><td class="label"><span>[[labels.subjects]]</span>:</td><td>[[fields.areas]]</td></tr>
          <tr><td class="label"><span>[[labels.levels]]</span>:</td><td>[[fields.levels]]</td></tr>
          <tr><td class="label"><span>[[labels.date]]</span>:</td><td>[[prj.date]]</td></tr>
          <tr><td class="label"><span>[[labels.license]]</span>:</td><td id="license"></td></tr>
        </table>
      </paper-dialog-scrollable>      
      <div class="buttons">
        <paper-icon-button mini icon="av:play-circle-filled" title="[[labels.playText]]" id="play" on-tap="_tapPlay"></paper-icon-button>
        <!-- paper-button id="play" icon="av:play-arrow" title="[[labels.playText]]" on-tap="_tapPlay">[[labels.play]]</paper-button -->
        <paper-icon-button disabled="[[appletDisabled]]" mini icon="maps:local-cafe" id="playApplet" title="[[labels.playAppletText]]" on-tap="_tapPlayApplet"></paper-icon-button>
        <!-- paper-button id="playApplet" title="[[labels.playAppletText]]" on-tap="_tapPlayApplet">[[labels.playApplet]]</paper-button -->
        <paper-icon-button disabled="[[instalDisabled]]" mini icon="file-download" id="install" title="[[labels.installText]]" on-tap="_tapInstall"></paper-icon-button>
        <paper-icon-button disabled="[[linkDisabled]]" mini icon="av:video-library" id="clicZone" title="[[labels.linkClicZoneText]]" on-tap="_tapLinkClicZone"></paper-icon-button>
        <paper-icon-button mini icon="social:share" id="share" title="[[labels.shareText]]" on-tap="_tapShare"></paper-icon-button>
        <span class="flex"></span>
        <paper-icon-button dialog-dismiss icon="close" title="[[labels.close]]"></paper-icon-button>
        <!-- paper-button dialog-dismiss>[[labels.close]]</paper-button -->
      </div>
      <content></content>
    </paper-dialog>

    <paper-dialog id="share" modal entry-animation="scale-up-animation" exit-animation="fade-out-animation">
      <h2>[[labels.shareText]]</h2>
      <div class="layout vertical center-center">
        <paper-material elevation="1">
          <paper-input id="linkToProject" label="Link to project page:" readonly="true" size="10" value="[[linkToPage]]" style="min-width: 500px"></paper-input>
          <paper-icon-button icon="content-copy" title="copy" on-tap="_copyPageLink"></paper-icon-button>
        </paper-material>
        <paper-material elevation="1">
          <paper-input id="linkToActivities" label="Direct link to the activities:" readonly="true" size="10" value="[[linkToActivities]]" style="min-width: 500px"></paper-input>
          <paper-icon-button icon="content-copy" title="copy" on-tap="_copyActLink"></paper-icon-button>
        </paper-material>
        <paper-material elevation="1">
          <paper-textarea id="embedCode" label="Embed code:" readonly="true" size="10" value="[[embedCode]]" style="min-width: 500px"></paper-textarea>
          <div style="width: 100%">
            <paper-button toggles>500x400</paper-button>
            <paper-button toggles>800x600</paper-button>
            <paper-button toggles>1024x800</paper-button>          
            <span class="flex"></span>
            <paper-icon-button icon="content-copy" title="copy" on-tap="_copyEmbedCode"></paper-icon-button>
          </div>        
        </paper-material>
      </div>
      <div class="buttons">
        <span class="flex"></span>        
        <paper-icon-button dialog-dismiss icon="close" title="[[labels.close]]"></paper-icon-button>
      </div>      
    </paper-dialog>

  </template>
</dom-module>

<script>
  /* global clipboard */

  Polymer({
    is: 'big-prj-card',
    properties: {
      /**
       * The project data.
       */
      prj: {
        type: Object,
        observer: '_prjChanged'
      },
      path: {
        type: String,
        value: ''
      },
      labels: {
        type: Object,
        value: {}
      },
      lang: {
        type: String
      },
      imgSrc: {
        type: String,
        computed: 'computeImgSrc(path, prj)'
      },
      fields: {
        type: Object,
        computed: 'computeFields(prj, lang)',
        observer: '_fieldsChanged'
      },
      appletDisabled: {
        type: String,
        computed: 'computeAppletDisabled(prj)'
      },
      instalDisabled: {
        type: String,
        computed: 'computeInstalDisabled(prj)'
      },
      linkDisabled: {
        type: String,
        computed: 'computeLinkDisabled(prj)'
      },
      linkToPage: {
        type: String,
        computed: 'computeLinkToPage(prj)'
      },
      linkToActivities: {
        type: String,
        computed: 'computeLinkToActivities(prj)'
      },
      embedCode: {
        type: String,
        computed: 'computeEmbedCode(prj)'
      }
    },
    computeImgSrc: function (path, prj) {
      return path + '/' + prj.cover;
    },
    computeFields: function (prj, lang) {
      return {
        description: prj.description[lang],
        languages: prj.languages[lang],
        areas: prj.areas[lang],
        levels: prj.levels[lang],
        license: prj.license[lang]
      };
    },
    computeAppletDisabled: function () {
      return !this.prj.zipFile || this.prj.app.javaDisabled;
    },
    computeInstalDisabled: function () {
      return !this.prj.instFile || this.prj.app.javaDisabled;
    },
    computeLinkDisabled: function () {
      return !this.prj.clicZoneURL;
    },
    computeLinkToPage: function () {
      return 'link to page is https://19871de1c937261bf4698a4879171a4a60cba924.googledrive.com/host/0B1eFfedhm-71fjdnaFg1dV8wN3gwMWQzNU11dXlIejg3S1dtdFYzRWhIX0lhbE1WdG1EcEk/index.html';
    },
    computeLinkToActivities: function () {
      return 'link to activities is https://19871de1c937261bf4698a4879171a4a60cba924.googledrive.com/host/0B1eFfedhm-71fjdnaFg1dV8wN3gwMWQzNU11dXlIejg3S1dtdFYzRWhIX0lhbE1WdG1EcEk/index.html';
    },
    computeEmbedCode: function () {
      return 'embed code is https://19871de1c937261bf4698a4879171a4a60cba924.googledrive.com/host/0B1eFfedhm-71fjdnaFg1dV8wN3gwMWQzNU11dXlIejg3S1dtdFYzRWhIX0lhbE1WdG1EcEk/index.html';
    },
    _prjChanged: function (prj) {
      this.setAttribute('aria-label', prj.title);
    },
    _fieldsChanged: function (fields) {
      this.$.description.innerHTML = fields.description;
      this.$.license.innerHTML = fields.license;
    },
    getPaperDialog: function () {
      return this.$.dialog;
    },
    _tapPlay: function () {
      this.prj.app.playActivities(this.prj);
    },
    _tapPlayApplet: function () {
      this.prj.app.openApplet(this.prj);
    },
    _tapInstall: function () {
      this.prj.app.openInstall(this.prj);
    },
    _tapLinkClicZone: function () {
      this.prj.app.goToClicZone(this.prj);
    },
    _tapShare: function () {
      this.$.share.open();
    },
    _copyPageLink: function(){
      clipboard.copy(this.linkToPage);      
    },
    _copyActLink: function(){
      clipboard.copy(this.linkToActivities);      
    },
    _copyEmbedCode: function(){
      clipboard.copy(this.embedCode);      
    }    
  });
</script>